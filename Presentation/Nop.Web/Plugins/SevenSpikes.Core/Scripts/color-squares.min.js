/*
* Copyright 2016 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

!function(t,e,r){function o(){var t=[];return e(d).each(function(){var r=e(this).attr("data-productid");if(r&&r>0){var o={productId:r,productElement:e(this)};t.push(o)}}),t}function a(t,o){var a=r.getAttrValFromDom(n,"data-productbox-container-selector");if(a){var c=o.productElement.find(a);if(!(c.find("ul.color-squares").length>0)&&c&&o.productId&&o.productId>0){var u=o.productId,d=e(t).filter("ul[data-productId='"+u+"']");if(d&&d.length>0){e(c).append(d),e(c).addClass("color-squares-active");var i=e(".product-item").has("[data-productid="+u+"]");i.find(" .second-product-image").remove(),i.find(".product-box-color-square.preselected").click()}}}}function c(t,e){if(e&&e.length>0)for(var r=0;r<e.length;r++)a(t,e[r])}function u(){return r.getAttrValFromDom(n,"data-retrieve-color-squares-url")}var d,n="#color-squares-info";t.getColorSquares=function(){var t=o();if(t&&0!==t.length){for(var r=[],a=0;a<t.length;a++){var d=t[a];d.hasOwnProperty("productId")&&r.push(d.productId)}var n={productIds:r},i=u();e.ajax({cache:!1,type:"POST",data:e.toJSON(n),contentType:"application/json; charset=utf-8",url:i,success:function(r){r&&(c(r,t),e.event.trigger({type:"colorSquaresLoadingCompleteEvent"}))},error:function(){}})}},e(document).ready(function(){d=r.getAttrValFromDom(n,"data-productbox-selector"),d&&t.getColorSquares()}),e(document).on("click",".product-box-color-square",function(){var t=e(this),o=t.closest("li");if(!o.hasClass("selected-value")){var a=r.getAttrValFromDom("#color-squares-info","data-product-attribute-change-url"),c=t.closest(".product-item").data("productid");if(c&&c>0){var u={};u[t.attr("name")]=t.attr("value"),e.ajax({cache:!1,url:a+"?productId="+c+"&validateAttributeConditions=true",data:u,type:"POST",success:function(e){if(e.price){var o=r.getAttrValFromDom("#color-squares-info","data-productbox-price-selector"),a=t.closest(".product-item").find(o);a.length>0&&a.text(e.price)}}})}if(o.attr("data-picture-url")){var d=t.closest(".product-item").find(".picture img");d.length>0&&d.attr("src",o.attr("data-picture-url"))}o.addClass("selected-value"),o.siblings(".selected-value").removeClass("selected-value")}}),e(document).on("nopAjaxFiltersFiltrationCompleteEvent newProductsAddedToPageEvent",t.getColorSquares)}(window.colorSquares=window.colorSquares||{},jQuery,sevenSpikes);